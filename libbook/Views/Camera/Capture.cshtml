@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>WebcamJS Test Page</title>
    <link href="~/Content/bootstrap.css" rel="stylesheet" />
    <style type="text/css">

        body {
            font-family: Helvetica, sans-serif;
        }

        h2, h3 {
            margin-top: 0;
        }

        form {
            margin-top: 15px;
        }

            form > input {
                margin-right: 15px;
            }


        #buttonhide {
            background: transparent;
            border: none !important;
            font-size: 0;
        }
    </style>

</head>
<body class="container">
    <br />
    <div class="col-md-2"></div>
    <div class="col-md-4">
        <div class="panel panel-default">
            <div class="panel-heading">Camera</div>
            <div class="panel-body">
                <div id="my_camera"></div>

                <form>
                    <input type="button" class="btn btn-success" value="Take Snapshots" onClick="take_snapshot()">
                  
                </form>

            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="panel panel-default">
            <div class="panel-heading">Captured Photo</div>
            <div class="panel-body">
                <div id="results">Your captured image will appear here...</div>
            </div>
            <br />
            <br />
        </div>
    </div>

    <div class="col-md-2">    </div>

    <script src="~/Scripts/webcamjs/webcam.js"></script>
    <script src="~/Scripts/jquery-3.4.1.min.js"></script>
    <script language="JavaScript">
        Webcam.set({
            
            width: 320,
            height: 240,
            image_format: 'jpeg',
            jpeg_quality: 90,
         facingMode: { exact: 'environment' }
        });
        Webcam.set('constraints', {
            facingMode: "environment"
        });
        Webcam.attach('#my_camera');
    </script>


    <script lang="JavaScript">

        let base64String = "";
        var today = new Date();
        var dd = String(today.getDate()).padStart(2, '0');
        var mm = String(today.getMonth() + 1).padStart(2, '0'); 
        var yyyy = today.getFullYear();
        var hr = today.getHours();
        var min = today.getMinutes();
        var sec = today.getSeconds();

        today = mm + '_' + dd + '_' + yyyy + '_' + hr + '_' + min+'_'+sec;

        var name = today + '.jpg';

        function take_snapshot() {
           
            // take snapshot and get image data
            Webcam.snap(function (data_uri) {
                // display results in page
                document.getElementById('results').innerHTML =
                    '<img id="imageprev" src="' +
                    data_uri +
                    '"/>';

                base64String = data_uri.replace("data:", "")
                    .replace(/^.+,/, "");

                   data_uri = base64String;
                    // downloadImage(today, data_uri);
                    submitForm(data_uri);

                });

        
        }
        function imageUploaded(data_uri) {
            let base64String = "";
            var reader = new FileReader();
            console.log("next");

            reader.onload = function () {
                base64String = data_uri.replace("data:", "")
                    .replace(/^.+,/, "");

                data_uri = base64String;

                // alert(imageBase64Stringsep);
                console.log(base64String);
            }
         
        }


         function submitForm(data_uri) {

             var model = data_uri;



            jQuery.ajax({
                type: "POST",
                url: "@Url.Action("Capture","Camera")",
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify({ filePath: model }),
                success: function (response) {
                    if (response) {              
                        window.location.href = response.redirectToUrl;
                    }
                },
                failure: function (response) {
                    alert(errMsg);
                }
            });

        }
        downloadImage = function (name, datauri) {
            var a = document.createElement('a');
            a.setAttribute('download', name );
            a.setAttribute('href', datauri);
            a.click();
        }
    </script>
    
   






</body>
</html>
